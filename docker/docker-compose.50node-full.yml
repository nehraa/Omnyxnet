# =============================================================================
# Docker Compose - 50-Node Hyper-Scale Test Environment (Mandate 3)
# =============================================================================
# AUTO-GENERATED - DO NOT EDIT MANUALLY
# Generated by: scripts/generate_50node_compose.py
#
# Sets up a 50-node mesh network for comprehensive E2E testing including:
# - 3 Bootstrap nodes for network discovery
# - 5 Aggregator/Parameter Server nodes for ML coordination
# - 40 Worker nodes for distributed ML training
# - 2 GUI client nodes for testing
#
# Network: 172.30.0.0/24
# IP Range: 172.30.0.10 - 172.30.0.75
#
# Usage:
#   docker-compose -f docker-compose.50node.yml up -d
#   docker-compose -f docker-compose.50node.yml ps
#   docker-compose -f docker-compose.50node.yml logs -f worker1
#   docker-compose -f docker-compose.50node.yml down
#
# Test Scenarios (Mandate 3):
#   1. Tor Communication: Test --use-tor flag between arbitrary nodes
#   2. Ephemeral Chat: Start chat session with encryption
#   3. ML Training: Distribute dataset to 40 workers, aggregate gradients
#   4. Fault Tolerance: Kill 5 random workers, verify continued operation
# =============================================================================

version: "3.8"

services:

  # =========================================================================
  # Bootstrap Nodes (3 nodes) - Network Discovery & DHT
  # =========================================================================

  bootstrap1:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-bootstrap1
    hostname: bootstrap1
    command: >
      ./go-node 
      -node-id=1 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9081
      -mdns=true
      -local
    ports:
      - "8081:8080"
      - "9081:9081"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.10
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 3
    environment:
      - RUST_LOG=info
      - RUST_BACKTRACE=1
      - GO_NODE_ROLE=bootstrap


  bootstrap2:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-bootstrap2
    hostname: bootstrap2
    command: >
      ./go-node 
      -node-id=2 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9082
      -mdns=true
      -local
    ports:
      - "8082:8080"
      - "9082:9082"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.11
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 3
    environment:
      - RUST_LOG=info
      - RUST_BACKTRACE=1
      - GO_NODE_ROLE=bootstrap


  bootstrap3:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-bootstrap3
    hostname: bootstrap3
    command: >
      ./go-node 
      -node-id=3 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9083
      -mdns=true
      -local
    ports:
      - "8083:8080"
      - "9083:9083"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.12
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 3
    environment:
      - RUST_LOG=info
      - RUST_BACKTRACE=1
      - GO_NODE_ROLE=bootstrap


  # =========================================================================
  # Aggregator/Parameter Server Nodes (5 nodes) - ML Coordination
  # =========================================================================

  aggregator1:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-aggregator1
    hostname: aggregator1
    command: >
      ./go-node 
      -node-id=101 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9101
      -mdns=true
      -local
    ports:
      - "8101:8080"
      - "9101:9101"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.20
    depends_on:
      - bootstrap1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      - RUST_LOG=info
      - GO_NODE_ROLE=aggregator
      - ML_AGGREGATION_METHOD=fedavg
      - ML_MIN_WORKERS=30


  aggregator2:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-aggregator2
    hostname: aggregator2
    command: >
      ./go-node 
      -node-id=102 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9102
      -mdns=true
      -local
    ports:
      - "8102:8080"
      - "9102:9102"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.21
    depends_on:
      - bootstrap1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      - RUST_LOG=info
      - GO_NODE_ROLE=aggregator
      - ML_AGGREGATION_METHOD=fedavg
      - ML_MIN_WORKERS=30


  aggregator3:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-aggregator3
    hostname: aggregator3
    command: >
      ./go-node 
      -node-id=103 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9103
      -mdns=true
      -local
    ports:
      - "8103:8080"
      - "9103:9103"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.22
    depends_on:
      - bootstrap1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      - RUST_LOG=info
      - GO_NODE_ROLE=aggregator
      - ML_AGGREGATION_METHOD=fedavg
      - ML_MIN_WORKERS=30


  aggregator4:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-aggregator4
    hostname: aggregator4
    command: >
      ./go-node 
      -node-id=104 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9104
      -mdns=true
      -local
    ports:
      - "8104:8080"
      - "9104:9104"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.23
    depends_on:
      - bootstrap1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      - RUST_LOG=info
      - GO_NODE_ROLE=aggregator
      - ML_AGGREGATION_METHOD=fedavg
      - ML_MIN_WORKERS=30


  aggregator5:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-aggregator5
    hostname: aggregator5
    command: >
      ./go-node 
      -node-id=105 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9105
      -mdns=true
      -local
    ports:
      - "8105:8080"
      - "9105:9105"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.24
    depends_on:
      - bootstrap1
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8080"]
      interval: 10s
      timeout: 5s
      retries: 5
    environment:
      - RUST_LOG=info
      - GO_NODE_ROLE=aggregator
      - ML_AGGREGATION_METHOD=fedavg
      - ML_MIN_WORKERS=30


  # =========================================================================
  # Worker Nodes (40 nodes) - ML Training Workers
  # =========================================================================

  worker1:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker1
    hostname: worker1
    command: >
      ./go-node 
      -node-id=201 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9201
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.30
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker2:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker2
    hostname: worker2
    command: >
      ./go-node 
      -node-id=202 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9202
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.31
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker3:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker3
    hostname: worker3
    command: >
      ./go-node 
      -node-id=203 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9203
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.32
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker4:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker4
    hostname: worker4
    command: >
      ./go-node 
      -node-id=204 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9204
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.33
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker5:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker5
    hostname: worker5
    command: >
      ./go-node 
      -node-id=205 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9205
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.34
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker6:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker6
    hostname: worker6
    command: >
      ./go-node 
      -node-id=206 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9206
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.35
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker7:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker7
    hostname: worker7
    command: >
      ./go-node 
      -node-id=207 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9207
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.36
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker8:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker8
    hostname: worker8
    command: >
      ./go-node 
      -node-id=208 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9208
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.37
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker9:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker9
    hostname: worker9
    command: >
      ./go-node 
      -node-id=209 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9209
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.38
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker10:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker10
    hostname: worker10
    command: >
      ./go-node 
      -node-id=210 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9210
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.39
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker11:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker11
    hostname: worker11
    command: >
      ./go-node 
      -node-id=211 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9211
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.40
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker12:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker12
    hostname: worker12
    command: >
      ./go-node 
      -node-id=212 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9212
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.41
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker13:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker13
    hostname: worker13
    command: >
      ./go-node 
      -node-id=213 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9213
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.42
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker14:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker14
    hostname: worker14
    command: >
      ./go-node 
      -node-id=214 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9214
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.43
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker15:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker15
    hostname: worker15
    command: >
      ./go-node 
      -node-id=215 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9215
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.44
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker16:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker16
    hostname: worker16
    command: >
      ./go-node 
      -node-id=216 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9216
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.45
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker17:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker17
    hostname: worker17
    command: >
      ./go-node 
      -node-id=217 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9217
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.46
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker18:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker18
    hostname: worker18
    command: >
      ./go-node 
      -node-id=218 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9218
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.47
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker19:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker19
    hostname: worker19
    command: >
      ./go-node 
      -node-id=219 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9219
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.48
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker20:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker20
    hostname: worker20
    command: >
      ./go-node 
      -node-id=220 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9220
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.49
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker21:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker21
    hostname: worker21
    command: >
      ./go-node 
      -node-id=221 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9221
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.50
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker22:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker22
    hostname: worker22
    command: >
      ./go-node 
      -node-id=222 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9222
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.51
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker23:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker23
    hostname: worker23
    command: >
      ./go-node 
      -node-id=223 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9223
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.52
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker24:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker24
    hostname: worker24
    command: >
      ./go-node 
      -node-id=224 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9224
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.53
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker25:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker25
    hostname: worker25
    command: >
      ./go-node 
      -node-id=225 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9225
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.54
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker26:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker26
    hostname: worker26
    command: >
      ./go-node 
      -node-id=226 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9226
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.55
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker27:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker27
    hostname: worker27
    command: >
      ./go-node 
      -node-id=227 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9227
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.56
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker28:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker28
    hostname: worker28
    command: >
      ./go-node 
      -node-id=228 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9228
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.57
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker29:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker29
    hostname: worker29
    command: >
      ./go-node 
      -node-id=229 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9229
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.58
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker30:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker30
    hostname: worker30
    command: >
      ./go-node 
      -node-id=230 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9230
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.59
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker31:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker31
    hostname: worker31
    command: >
      ./go-node 
      -node-id=231 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9231
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.60
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker32:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker32
    hostname: worker32
    command: >
      ./go-node 
      -node-id=232 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9232
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.61
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker33:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker33
    hostname: worker33
    command: >
      ./go-node 
      -node-id=233 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9233
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.62
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker34:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker34
    hostname: worker34
    command: >
      ./go-node 
      -node-id=234 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9234
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.63
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker35:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker35
    hostname: worker35
    command: >
      ./go-node 
      -node-id=235 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9235
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.64
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker36:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker36
    hostname: worker36
    command: >
      ./go-node 
      -node-id=236 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9236
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.65
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker37:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker37
    hostname: worker37
    command: >
      ./go-node 
      -node-id=237 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9237
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.66
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker38:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker38
    hostname: worker38
    command: >
      ./go-node 
      -node-id=238 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9238
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.67
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker39:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker39
    hostname: worker39
    command: >
      ./go-node 
      -node-id=239 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9239
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.68
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  worker40:
    build:
      context: ../go
      dockerfile: Dockerfile
    container_name: wgt-worker40
    hostname: worker40
    command: >
      ./go-node 
      -node-id=240 
      -capnp-addr=:8080 
      -libp2p=true 
      -libp2p-port=9240
      -mdns=true
      -local
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.69
    depends_on:
      - bootstrap1
      - aggregator1
    environment:
      - RUST_LOG=warn
      - GO_NODE_ROLE=worker


  # =========================================================================
  # GUI Client Nodes (2 nodes) - Testing GUI Functionality
  # =========================================================================

  gui-client1:
    build:
      context: ../
      dockerfile: docker/Dockerfile.python-gui
    container_name: wgt-gui-client1
    hostname: gui-client1
    ports:
      - "8201:8080"
      - "5901:5900"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.70
    depends_on:
      - bootstrap1
      - bootstrap2
    environment:
      - DISPLAY=:0
      - GO_NODE_HOST=bootstrap1
      - GO_NODE_PORT=8080


  gui-client2:
    build:
      context: ../
      dockerfile: docker/Dockerfile.python-gui
    container_name: wgt-gui-client2
    hostname: gui-client2
    ports:
      - "8202:8080"
      - "5902:5900"
    networks:
      wgt-mesh:
        ipv4_address: 172.30.0.71
    depends_on:
      - bootstrap1
      - bootstrap2
    environment:
      - DISPLAY=:0
      - GO_NODE_HOST=bootstrap2
      - GO_NODE_PORT=8080


networks:
  wgt-mesh:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.30.0.0/24


# Generated configuration:
#   Bootstrap nodes: 3
#   Aggregator nodes: 5
#   Worker nodes: 40
#   GUI clients: 2
#   Total: 50 nodes
#   IP range: 172.30.0.10 - 172.30.0.71
